generator client {
  provider = "prisma-client"
  output     = "./generated"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  SUPER_ADMIN
  GYM_OWNER
  MEMBER
}

enum SubscriptionType {
  MONTHLY
  YEARLY
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
}

enum SubscriptionTypeEnum {
  OWNER
  MEMBER
}

enum AnnouncementAudience {
  ALL
  GYM_OWNER
  MEMBER
}

// User model
model User {
  id                String        @id @default(uuid())
  first_name        String
  last_name         String
  phone_number      String
  address           String
  city              String
  state             String
  zip_code          String
  country           String
  date_of_birth     DateTime
  cnic              String?
  profile_picture   String?
  email             String?
  password          String?
  role              Role          @default(MEMBER)
  is_active         Boolean       @default(true)
  is_deleted        Boolean       @default(false)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  todos             Todo[]
  gyms_owned        Gym[]         @relation("UserGyms")
  member            Member?

  ownerSubscriptions OwnerSubscription[]
}

model Todo {
  id           String   @id @default(uuid())
  title        String
  description  String
  is_completed Boolean  @default(false)
  is_active    Boolean  @default(true)
  is_deleted   Boolean  @default(false)
  user_id      String
  user         User     @relation(fields: [user_id], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

enum BillingModel {
  MONTHLY
  YEARLY
}

// Gym model
model Gym {
  id           String       @id @default(uuid())
  name         String
  owner_id     String
  address      String?
  city         String?
  state        String?
  zip_code     String?
  country      String?
  phone_number String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  is_active    Boolean      @default(true)
  is_deleted   Boolean      @default(false)
  // Relations
  owner        User         @relation("UserGyms", fields: [owner_id], references: [id])
  members      Member[]
  equipment    Equipment[]
  locations    Location[]
}

model Location {
  id           String   @id @default(uuid())
  gym_id       String
  name         String
  address      String?
  city         String?
  state        String?
  zip_code     String?
  country      String?
  phone_number String?
  is_active    Boolean  @default(true)
  is_deleted   Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  gym          Gym      @relation(fields: [gym_id], references: [id])
}

// Member model
model Member {
  id       String   @id @default(uuid())
  user_id  String   @unique
  gym_id   String
  joinedAt DateTime @default(now())

  // Relations
  user       User         @relation(fields: [user_id], references: [id])
  gym        Gym          @relation(fields: [gym_id], references: [id])
  memberSubscriptions MemberSubscription[]
}


// Equipment model
model Equipment {
  id         String  @id @default(uuid())
  name       String
  type       String
  quantity   String
  weight     String?
  is_active  Boolean @default(true)
  is_deleted Boolean @default(false)
  gym_id     String
  gym        Gym     @relation(fields: [gym_id], references: [id])
}

model Plan {
  id                  String                @id @default(uuid())
  name                String
  monthly_price       Int
  yearly_price        Int
  max_gyms            Int
  max_locations       Int                   @default(0)
  max_members         Int
  max_equipment       Int
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  is_active           Boolean               @default(true)
  is_deleted          Boolean               @default(false)

  ownerSubscriptions OwnerSubscription[]
}

model Announcement {
  id         String               @id @default(uuid())
  title      String
  message    String
  audience   AnnouncementAudience @default(ALL)
  is_active  Boolean              @default(true)
  is_deleted Boolean              @default(false)
  createdAt  DateTime             @default(now())
  updatedAt  DateTime             @updatedAt
}

model OwnerSubscription {
  id                  String        @id @default(uuid())
  owner_id            String
  plan_id             String
  billing_model       BillingModel
  start_date          DateTime
  end_date            DateTime
  is_expired          Boolean       @default(false)
  notification_sent   Boolean       @default(false)
  is_active           Boolean       @default(true)
  is_deleted          Boolean       @default(false)
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  
  // Relations
  owner               User          @relation(fields: [owner_id], references: [id])
  plan                Plan          @relation(fields: [plan_id], references: [id])
  payments            Payment[]
}

model MemberSubscription {
  id                  String        @id @default(uuid())
  member_id           String
  price               Int
  billing_model       BillingModel
  start_date          DateTime
  end_date            DateTime
  is_expired          Boolean       @default(false)
  notification_sent    Boolean       @default(false)
  is_active           Boolean       @default(true)
  is_deleted          Boolean       @default(false)
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  
  // Relations
  member              Member        @relation(fields: [member_id], references: [id])
  payments            Payment[]
}

model Payment {
  id                      String              @id @default(uuid())
  owner_subscription_id   String?
  member_subscription_id  String?
  subscription_type       SubscriptionTypeEnum
  amount                  Int
  payment_method          PaymentMethod
  transaction_id          String?
  payment_date            DateTime
  notes                   String?
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt
  
  // Relations
  ownerSubscription       OwnerSubscription?  @relation(fields: [owner_subscription_id], references: [id])
  memberSubscription     MemberSubscription? @relation(fields: [member_subscription_id], references: [id])
}